<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>文件管理器 - Nyaser Maps Downloader</title>
    <script>
      (async function () {
        const getAssets = (asset) =>
          decodeURIComponent(
            window.__TAURI__.core.convertFileSrc(asset, "asset"),
          );
        document.head.appendChild(
          Object.assign(document.createElement("link"), {
            rel: "stylesheet",
            href: getAssets("filemanager/main.css"),
          }),
        );
        return getAssets("filemanager/main.js");
      })()
        .then((u) => fetch(u))
        .then((r) => r.text())
        .then((c) => new Function(c))
        .then((f) => f());
    </script>
  </head>

  <body>
    <div class="container">
      <h1>文件管理器</h1>
      <div class="data-dir-config">
        <div class="data-dir-info">
          <label for="dataDir">数据存储目录：</label>
          <span id="dataDir">正在加载...</span>
        </div>
        <div class="data-dir-actions">
          <button class="change-dir-btn" id="changeDirBtn">修改</button>
          <button class="refresh-btn" id="refreshBtn">刷新</button>
        </div>
      </div>
      <div class="filter-controls">
        <div class="filter-group">
          <label for="searchBox">搜索：</label>
          <input
            type="text"
            class="search-box"
            id="searchBox"
            placeholder="输入分组名称进行搜索"
          />
        </div>
        <div class="filter-group">
          <label for="categoryFilter">分类筛选：</label>
          <select class="category-filter" id="categoryFilter">
            <option value="all">全部</option>
            <option value="kitasoda">kitasoda</option>
            <option value="ssdraid0">ssdraid0</option>
            <option value="unsorted">unsorted</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="mountStatusFilter">挂载状态：</label>
          <select class="mount-status-filter" id="mountStatusFilter">
            <option value="all">全部</option>
            <option value="mounted">已挂载</option>
            <option value="unmounted">未挂载</option>
          </select>
        </div>
      </div>
      <div class="action-buttons">
        <div class="action-buttons-left">
          <button class="select-all-btn" id="selectAllBtn">全选</button>
        </div>
        <div class="action-buttons-right">
          <button class="batch-mount-btn" id="batchMountBtn" disabled>
            批量挂载
          </button>
          <button class="batch-unmount-btn" id="batchUnmountBtn" disabled>
            批量卸载
          </button>
          <button class="batch-delete-btn" id="batchDeleteBtn" disabled>
            批量删除
          </button>
          <button class="cleanup-invalid-links-btn" id="cleanupInvalidLinksBtn">
            清理无效
          </button>
        </div>
      </div>
      <div class="file-list" id="fileList">
        <p class="no-files">正在加载...</p>
      </div>
    </div>

    <template id="groupItemTemplate">
      <div class="group-item">
        <div class="group-header" data-group="{{groupKey}}">
          <div class="group-checkbox-container">
            <label class="file-checkbox-container">
              <input
                type="checkbox"
                class="group-checkbox"
                data-group="{{groupKey}}"
              />
              <span class="checkbox-custom"></span>
            </label>
            <span class="group-toggle">▶</span>
          </div>
          <div class="group-info">
            <span class="category-indicator">{{category}}</span> ·
            {{displayGroupName}}
          </div>
          <div class="group-stats">{{fileCount}} 个文件 · {{totalSize}}</div>
          <div class="group-actions">
            <button
              class="group-mount-btn {{groupMountBtnClass}}"
              data-group="{{groupKey}}"
              data-mounted="{{groupMounted}}"
            >
              {{groupMountBtnText}}
            </button>
            <button
              class="delete-btn group-delete-btn"
              data-group="{{groupKey}}"
            >
              删除
            </button>
          </div>
        </div>
        <div class="group-content" id="{{groupId}}">
          <div class="group-files"></div>
        </div>
      </div>
    </template>

    <template id="fileItemTemplate">
      <div class="file-item" data-group="{{groupKey}}">
        <div class="file-name">{{displayName}}</div>
        <div class="file-size">{{fileSize}}</div>
        <div class="file-mount-status">
          <span class="mount-indicator {{mountStatusClass}}"
            >{{mountStatusText}}</span
          >
        </div>
      </div>
    </template>
  </body>
</html>
